---
layout:     post
title:      "파이썬 정규표현식"
subtitle:   "프로그래밍을 배우기 전에 정규표현식부터 배워야 한다??"
date:       2018-04-26 12:00:00
author:     "Inbum"
header-img: "img/post-bg-python-regex.jpg"
header-mask: 0.3
category:   python
catalog:    true
multilingual: false
tags:
    - python
sitemap:
    priority: 0.5
    changefreq: 'monthly'
    lastmod: 2018-04-26 12:00:00
---

### 정규표현식 
정규표현식은 특정한 규칙을 가진 문자열의 집합을 표현하는 데 사용하는 형식 언어입니다. 정규 표현식은 많은 텍스트 편집기와 프로그래밍 언어에서 문자열의 검색과 치환을 위해 지원하고 있습니다. 특히 마이크로소프트 워드 또는 오픈오피스와 같은 편집기와 워드프로세서의 찾기 및 찾아 바꾸기 기능에서도 이 정규표현식 기반으로 검색 할 수 있지만 프로그래머가 아닌 많은 사람들은 이를 잘 알지 못합니다. 정규표현식을 쓰면 일반 사용자 뿐만 아니라 프로그래머도 엄청나게 시간을 절약할 수 있습니다. 기술 전문 저자인, 코리 닥터로우는 프로그래밍을 가르치기 전에 정규표현식부터 교육해야 한다고 주장할 정도 입니다.

> [정규표현식을] 안다는 것은 문제를 3단계로 해결하는 것과 3,000 단계로 해결하는 것만큼이나 차이가 있을 수 있다. 여기에 푹 빠지면 몇 차례의 키보드 입력만으로 해결할 수 있는 문제가 다른 사람들에게는 지루하고 오류가 일어나기 쉬운 작업이라는 사실조차도 잊어비럴 것이다.  

이번 포스트에서는 파이썬에서 정규표현식으로 텍스트의 패턴을 찾는 방법에 대해 알아보겠습니다.  

### 1. 정규표현식을 사용하지 않는다면...
문자열 안에서 (서울의) 전화번호를 찾고 싶다고 가정해 보겠습니다. 실제 전화번호는 다양한 패턴이 존재하지만, 이해의 편의를 위해 검색 패턴은 2개의 숫자, 하이픈, 세 개의 숫자, 하이픈, 네 개의 숫자 순으로 정의하겠습니다. 즉, 다음과 같을 것입니다. 02-730-5800(청와대 민원실 전화번호...). 문자열이 이러한 패턴과 일치하는지 여부를 확인하는 함수를 만들어 보겠습니다. 실제로 이렇게 작성하면 좋지 않다는 것을 보여주는 소스입니다.
```
def isPhoneNumber(text):
    if len(text) != 11:
        return False

    for i in range(0, 2):
        if not text[i].isdecimal():
            return False

    if text[2] != '-':
        return False

    for i in range(3, 6):
        if not text[i].isdecimal():
            return False

    if text[6] != '-':
        return False

    for i in range(7, 11):
        if not text[i].isdecimal():
            return False

    return True

print('02-730-5800는 전화번호 입니까???')
print(isPhoneNumber('02-730-5800'))
print('Spam 은 전화번호 입니까???')
print(isPhoneNumber('Spam'))

$ python3 isPhoneNumber.py
02-730-5800는 전화번호 입니까???
True
Spam 은 전화번호 입니까???
False
```

일단 정상동작 하는 함수를 만들기는 했습니다. 이 함수를 이용해, 긴 문자열에서 서울시 전화번호 패턴(02-XXX-XXXX)의 문자열을 찾기 위한 코드를 작성하려면 어떻게 해야 할까요? 다음과 같이 작성해 보겠습니다.
```
message = '청와대 민원실 전화번호는 02-730-5800 입니다. 자동응답기로 연결되네요. 02-730-5800 장난전화 하지 마세요.'
for i in range(len(message)):
    chunk = message[i:i+11]
    if isPhoneNumber(chunk):
        print('전화번호: ' + chunk)

$ python3 isPhoneNumber.py
전화번호: 02-730-5800
전화번호: 02-730-5800
```
위 소스코드는 원하는대로 동작하긴 하지만, 한눈에 보기에도 비효율적으로 보입니다. 예를들어, 다른 서울시의 전화번호 패턴을 찾고 싶다면 어떻게 해야 할까요. '02-XXXX-XXXX' 또는 '02-XXX', '(02)XXX-XXXX' 와 같은 형태의 패턴도 함께 찾고 싶다면? 또는 전국의 모든 전화번호, 핸드폰 번호, 팩스번호 까지 포함한 모든 전화번호를 찾고 싶다면? 슬슬 머리가 아파오기 시작합니다. 정규표현식을 쓰면 이러한 프로그램을 더욱 효율적으로 빨리 만들 수 있습니다.

### 2. 정규표현식으로...
이번에는 정규표현식을 이용해 위와 동일한 패턴(02-XXX-XXXX)의 문자열을 찾는 소스코드를 작성해 보겠습니다.
```
import re

phoneNumRegex = re.compile(r'\d{2}-\d{3}-\d{4}')

message = '청와대 민원실 전화번호는 02-730-5800 입니다. 자동응답기로 연결되네요. 02-730-5800 장난전화 하지 마세요.'

for phoneNum in phoneNumRegex.findall(message)
    print('전화번호: ' + phoneNum)

$ python3 isPhoneNumber2.py
전화번호: 02-730-5800
전화번호: 02-730-5800
```
한눈에 보기에도 너무 간단한 소스코드가 되었습니다.  
간단히 설명하면,  
import re로 정규식 모듈을 가져온 뒤  
re.compile() 함수로 Regex객체를 만듭니다. (이때, 문자열 첫번째 따옴표 앞에 r을 놓아 원시 문자열을 전달하였습니다.)  
패턴과 일치하는 모든 문자열을 검색하기 위해 'message'변수를 findall()메소드로 전달한 뒤 출력했습니다.  
> 파이썬에서 다른언어들과 마찬가지로 백슬래시(\\)를 이스케이프 문자로 사용합니다.  
> \\n : line feed 줄바꿈  
> \\t : tab  
> \\r : carriage return  
> \\0 : null  
> \\ : back slash  
> \\' : single quotation mark(단일 인용 부호)  
> \\" : double quotation mark(다중 인용 부호)  
> 하지만 문자열 값의 첫 번째 따옴표 앞에 r을 붙여 원시 문자열(raw string), 즉 글자를 이스케이프하지 않는 문자열로 지정할 수 있습니다.  
> 정규표현식에서는 백슬래시를 자주 사용하기 때문에 원시문자열을 이용하여 전달하면 편리하게(백슬래시를 두번 사용할 필요 없이) 정규표현식을 표현할 수 있습니다.

### 3. 자주 사용하는 파이썬 정규표현식 문법  

| 메타문자 | 설명 | 
|---|---| 
| &#63; | 앞의 그룹이 0~1번 나타나는 패턴과 일치시킨다. |
| &#42; | 앞의 그룹이 0번 이상 나타나는 패턴과 일치시킨다. |
| &#43; | 앞의 그룹이 1번 이상 나타나는 패턴과 일치시킨다. |
| &#123;n&#125; | 앞의 그룹이 정확히 n번 나타나는 패턴과 일치시킨다. |
| &#123;n,&#125; | 앞의 그룹이 정확히 n번 이상 나타나는 패턴과 일치시킨다. |
| &#123;,m&#125; | 앞의 그룹이 정확히 0~m번까지 나타나는 패턴과 일치시킨다. |
| &#123;n,m&#125; | 앞의 그룹이 최소 n번, 최대 m번 나타나는 패턴과 일치시킨다. |
| &#94;spam | 문자열이 spam으로 시작해야 한다는 것을 의미합니다. |
| spam&#36; | 문자열이 spam으로 끝나야 한다는 것을 의미합니다. |
| &#46; | 줄바꿈 문자를 제외한 모든 글자와 일치시킨다. |
| \\d | 숫자를 일치시킨다. |
| \\w | \_를 포함한 영숫자를 일치시킨다. |
| \\s | 공백문자와 일치시킨다. |
| \\D | 숫자가 아닌 항목을 일치시킨다. |
| \\W | \_, 영숫자를 제외한 항목을 일치시킨다. |
| \\S | 공백문자를 제외한 항목을 일치시킨다. |
| &#91;aeiou&#93; | 대괄호 안의 모든 글자와 일치시킨다. (a,e,i,o,u) |
| &#91;&#94;aeiou&#93; | 대괄호 안의 항목을 제외한 글자와 일치시킨다. |

위의 예제에서 사용된 표현식 '\d{2}-\d{3}-\d{4}' 는,  
**숫자2개** **하이푼1개** **숫자3개** **하이푼1개** **숫자4개** 패턴과 일치하는 텍스트를 찾는 정규표현식 이다.

### 4. 정규표현식 예...
#### 전화번호 및 핸드폰 번호 정규표현식
아래는, 지역번호(2자리 및 3자리)를 포함한 전화번호 및 핸드폰번호를 검색할 수 있는 정규표현식 예 입니다.
```
phoneRegex = re.compile(r'((\d{2}|\(\d{2}\)|\d{3}|\(\d{3}\))?(|-|\.)?(\d{3}|\d{4})(\s|-|\.)(\d{4}))')
```
파이썬에서는 위와같이 복합한 정규표현식을 이해하기 쉽게 작성하기 위해 여러줄로 나누어 작성할 수 있다.
```
import re 

phoneRegex = re.compile(r'''(
    (\d{2}|\(\d{2}\)|\d{3}|\(\d{3}\))?      # 지역번호 : 2자리 또는 3자리, () 포함, 0번또는 1번  
    (|-|\.)?                                # 구분자 : 하이푼 또는 . 0번 또는 1번  
    (\d{3}|\d{4})                           # 3자리 또는 4자리 숫자  
    (\s|-|\.)                               # 구분자  
    (\d{4})                                 # 4자리 숫자  
    )''', re.VERBOSE)  
message = '청와대 민원실 전화번호는 02-730-5800 입니다. \  
          자동응답기로 연결되네요. \  
          02-730-5800 장난전화 하지 마세요. \  
          서울에서는 지역번호 없이 730-5800. 폰번호는 010-1234-1234 입니다.'  

for phoneNum in phoneRegex.findall(message):  
    print('전화번호: ' + str(phoneNum))  

$ python3 phoneRegex.py  
전화번호: ('02-730-5800', '02', '-', '730', '-', '5800')  
전화번호: ('02-730-5800', '02', '-', '730', '-', '5800')  
전화번호: ('730-5800', '', '', '730', '-', '5800')  
전화번호: ('010-1234-1234', '010', '-', '1234', '-', '1234')  
```
#### 이메일 주소 정규표현식
아래는, 거의 모든 일반적인 이메일 주소를 일치하는 정규표현식 입니다.
```
import re   

emailRegex = re.compile(r'''(  
    ([a-zA-Z0-9._%+-]+)      # 사용자명  
    @                        # @  
    ([a-zA-Z0-9.-]+)         # 도메인 이름  
    (\.[a-zA-Z]{2,4})        # 최상위 도메인  
    )''', re.VERBOSE)  

message = '청와대 담당자 이메일주소는 webmaster@president.go.kr \  
          제 이메일 주소는 inbum.o@gmail.com \  
          테스트 이메일 주소는 test123@abc123.com 입니다.'  

for email in emailRegex.findall(message):  
    print('이메일: ' + str(email))  

$ python3 emailRegex.py  
이메일: ('webmaster@president.go.kr', 'webmaster', 'president.go', '.kr')  
이메일: ('inbum.o@gmail.com', 'inbum.o', 'gmail', '.com')  
이메일: ('test123@abc123.com', 'test123', 'abc123', '.com')  
```
더 작성하기... ( 웹사이트 url찾기, 날짜형식 등등....)
